name: Deploy Vue (simples)

on:
  push:
    branches: [ master ]  # troque para main se necessÃ¡rio

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Deploy via SSH (git pull + build)
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.SSH_HOST }}
          port: ${{ secrets.SSH_PORT }}
          username: ${{ secrets.SSH_USER }}
          key: ${{ secrets.SSH_KEY }}
          timeout: 180s
          command_timeout: 15m
          script: |
            set -e
            DIR="${{ secrets.TARGET_DIR }}"

            echo ">> cd ${DIR}"
            cd "$DIR"

            echo ">> git pull"
            git pull --ff-only origin master || git pull

            echo ">> build"
            # tenta usar yarn; se nÃ£o tiver, usa npm
            if command -v corepack >/dev/null 2>&1; then
              corepack enable || true
              corepack prepare yarn@stable --activate || true
            fi

            if command -v yarn >/dev/null 2>&1; then
              yarn run build
            else
              npm run build
            fi

            echo ">> OK - $(date)"
